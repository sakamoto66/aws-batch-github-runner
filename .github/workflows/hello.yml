name: hello
on:
  workflow_dispatch:
jobs:
  StartRunner:
    runs-on: ubuntu-latest
    steps:
      - name: Start Self Hosted Runner
        run: |
          aws --region ap-northeast-1 batch submit-job \
          --job-name test \
          --job-queue github_self_runner_spot \
          --job-definition github_self_runner \
          --timeout attemptDurationSeconds=180 \
          --container-overrides '{"vcpus": 2, "environment":[{"name":"REPO_URL","value":"https://github.com/${{ github.repository }}/"},{"name":"LABELS","value":"loadtest"}]}'
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}

  test:
    needs: [StartRunner]
    runs-on: loadtest
    steps:
      - name: Hello
        run: |
          echo hello
